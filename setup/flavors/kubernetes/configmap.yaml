apiVersion: v1
kind: ConfigMap
metadata:
  name: mailu-config
  namespace: mailu-mailserver
data:
  # Mailu main configuration file
  #
  # Generated for {{ flavor }} flavor
  #
  # This file is autogenerated by the configuration management wizard.
  # For a detailed list of configuration variables, see the documentation at
  # https://mailu.io

  ###################################
  # Common configuration variables
  ###################################

  # Set to a randomly generated 16 bytes string
  SECRET_KEY: "{{ secret(16) }}"

  # Subnet of the docker network. This should not conflict with any networks to which your system is connected. (Internal and external!)
  SUBNET: "{{ subnet }}"

  # Main mail domain
  DOMAIN: "{{ domain }}"

  # Hostnames for this server, separated with comas
  HOSTNAMES: "{{ hostnames }}"

  # Postmaster local part (will append the main mail domain)
  POSTMASTER: "{{ postmaster }}"

  # Choose how secure connections will behave (value: letsencrypt, cert, notls, mail, mail-letsencrypt)
  TLS_FLAVOR: "cert" # cert from cert-manager will be used

  # Authentication rate limit (per source IP address)
  {% if auth_ratelimit_pm > '0' and auth_ratelimit_ph > '0' %}
  AUTH_RATELIMIT: "{{ auth_ratelimit_pm }}/minute;{{ auth_ratelimit_ph }}/hour"
  {% endif %}

  # Opt-out of statistics, replace with "True" to opt out
  DISABLE_STATISTICS: "{{ disable_statistics or 'False' }}"

  ###################################
  # Optional features
  ###################################

  # Expose the admin interface (value: true, false)
  ADMIN: "{{ admin_enabled or 'false' }}"

  # Choose which webmail to run if any (values: roundcube, rainloop, none)
  WEBMAIL: "{{ webmail_type }}"

  # Dav server implementation (value: radicale, none)
  WEBDAV: "{{ webdav_enabled or 'none' }}"

  # Antivirus solution (value: clamav, none)
  ANTIVIRUS: "{{ antivirus_enabled or 'none' }}"

  # Antispam solution
  ANTISPAM: "{{ antispam_enabled or 'none' }}"

  ###################################
  # Mail settings
  ###################################

  # Message size limit in bytes
  # Default: accept messages up to 50MB
  # Max attachment size will be 33% smaller
  MESSAGE_SIZE_LIMIT: "{{ message_size_limit or '50000000' }}"

  # Networks granted relay permissions
  # Use this with care, all hosts in this networks will be able to send mail without authentication!
  RELAYNETS: ""

  # Will relay all outgoing mails if configured
  RELAYHOST: "{{ relayhost }}"

  # This part is needed for the XCLIENT login for postfix.
  FRONT_ADDRESS: "front.mailu-mailserver.svc.cluster.local"

  # This value is needed by the webmail to find the correct imap backend
  IMAP_ADDRESS: "imap.mailu-mailserver.svc.cluster.local"

  # This value is used by Dovecot to find the Redis server in the cluster
  REDIS_ADDRESS: "redis.mailu-mailserver.svc.cluster.local"

  # Fetchmail delay
  FETCHMAIL_DELAY: "{{ fetchmail_delay or '600' }}"

  # Recipient delimiter, character used to delimiter localpart from custom address part
  # e.g. localpart+custom@domain;tld
  RECIPIENT_DELIMITER: "{{ recipient_delimiter or '+' }}"

  # DMARC rua and ruf email
  DMARC_RUA: "{{ dmarc_rua or 'admin' }}"
  DMARC_RUF: "{{ dmarc_ruf or 'admin' }}"

  {% if welcome_enabled %}
  # Welcome email, enable and set a topic and body if you wish to send welcome
  # emails to all users.
  WELCOME: "{{ welcome_enable or 'false' }}"
  WELCOME_SUBJECT: "{{ welcome_subject or 'Welcome to your new email account' }}"
  WELCOME_BODY: "{{ welcome_body or 'Welcome to your new email account, if you can read this, then it is configured properly!' }}"
  {% endif %}

  # Maildir Compression
  # choose compression-method, default: none (value: bz2, gz)
  COMPRESSION: "{{ compression }}"
  # change compression-level, default: 6 (value: 1-9)
  COMPRESSION_LEVEL: "{{ compression_level }}"

  ###################################
  # Web settings
  ###################################

  # Path to the admin interface if enabled
  # Kubernetes addition: You need to change ALL the ingresses, when you want this URL to be different!!!
  WEB_ADMIN: "{{ admin_path }}"

  # Path to the webmail if enabled
  # Currently, this is not used, because we intended to use a different subdomain: webmail.example.com
  # This option can be added in a feature release
  #WEB_WEBMAIL: "{{ webmail_path }}"

  # Website name
  SITENAME: "{{ site_name }}"

  # Linked Website URL
  WEBSITE: "{{ website }}"

  ###################################
  # Advanced settings
  ###################################

  # Default password scheme used for newly created accounts and changed passwords
  # (value: SHA512-CRYPT, SHA256-CRYPT, MD5-CRYPT, CRYPT)
  PASSWORD_SCHEME: "{{ password_scheme or 'BLF-CRYPT' }}"

  # Header to take the real ip from
  REAL_IP_HEADER: "{{ real_ip_header }}"

  # IPs for nginx set_real_ip_from (CIDR list separated by commas)
  REAL_IP_FROM: "{{ real_ip_from }}"

  # choose whether mailu bounces (no) or rejects (yes) mail when recipient is unknown (value: yes, no)
  REJECT_UNLISTED_RECIPIENT: "{{ reject_unlisted_recipient }}"

  ###################################
  # Kubernetes configuration
  ###################################

  # Use Kubernetes Ingress Controller to handle all actions on port 80 and 443
  # This way we can make use of the advantages of the cert-manager deployment
  KUBERNETES_INGRESS: "true"

  # Host settings
  HOST_IMAP: "imap.mailu-mailserver.svc.cluster.local"
  HOST_POP3: "imap.mailu-mailserver.svc.cluster.local"
  HOST_SMTP: "smtp.mailu-mailserver.svc.cluster.local"
  HOST_AUTHSMTP: "smtp.mailu-mailserver.svc.cluster.local"
  HOST_WEBMAIL: "webmail.mailu-mailserver.svc.cluster.local"
  HOST_ADMIN: "admin.mailu-mailserver.svc.cluster.local"
  HOST_WEBDAV: "webdav.mailu-mailserver.svc.cluster.local:5232"
  HOST_ANTISPAM: "antispam.mailu-mailserver.svc.cluster.local:11332"
  HOST_REDIS: "redis.mailu-mailserver.svc.cluster.local"
