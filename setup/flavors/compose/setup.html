{% import "macros.html" as macros %}

{% call macros.panel("info", "Step 1 - Download your configuration files") %}
<p>Docker Compose expects a project file, named <code>docker-compose.yml</code>
in a project directory. First create your project directory.</p>

<pre><code>mkdir {{ root }}
</pre></code>

<p>Then download the project file. A side configuration file makes it easier
to read and check the configuration variables generated by the wizard.</p>

<pre><code>cd {{ root }}
wget {{ url_for('.file', uid=uid, _scheme='https', filepath='docker-compose.yml', _external=True) }}
wget {{ url_for('.file', uid=uid, _scheme='https', filepath='mailu.env', _external=True) }}
</pre></code>
{% endcall %}


{% call macros.panel("info", "Step 2 - Review the configuration") %}
<p>We did not insert any malicious code on purpose in the configurations we
distribute, but your download could have been intercepted, or our wizard
website could have been compromised, so make sure you check the configuration
files before going any further.</p>

<p>When you are done checking them, check them one last time.</p>
{% endcall %}

{% call macros.panel("info", "Step 3 - Start the Compose project") %}
<p>To start your compose project, simply run the Docker Compose <code>up</code>
command using <code>-p mailu</code> flag for project name.</p>

<pre><code>cd {{ root }}
docker compose -p mailu up -d
</pre></code>

Before you can use Mailu, you must create the primary administrator user account. This should be {{ postmaster }}@{{ domain }}. Use the following command, changing PASSWORD to your liking:

<pre><code>docker compose -p mailu exec admin flask mailu admin {{ postmaster }} {{ domain }} PASSWORD
</pre></code>

<p>Login to the admin interface to change the password for a safe one, at
{% if admin_enabled %}
one of the hostnames 
<a href="https://{{ hostnames.split(',')[0] }}{{ admin_path }}">{{ hostnames.split(',')[0] }}{{ admin_path }}</a>.
{% else %}
<a href="http://127.0.0.1:8080/ui">http://127.0.0.1:8080/ui</a> (only directly from the host running docker).
If you run mailu on a remote server, and wish to access the admin interface via a SSH tunnel, you can create a port-forward from your local machine to your server like
<pre><code>ssh -L 127.0.0.1:8080:127.0.0.1:8080 &lt;user&gt;@&lt;server&gt;
</code></pre>
And access the above URL from your local machine.
<br />
{% endif %}
Also, choose the "Update password" option in the left menu.
</p>
{% endcall %}
