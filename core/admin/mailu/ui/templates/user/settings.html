{%- extends "base.html" %}

{%- block title %}
{% trans %}User settings{% endtrans %}
{%- endblock %}

{%- block subtitle %}
{{ user }}
{%- endblock %}

{%- block content %}
<form class="form" method="post" role="form">
  {{ form.hidden_tag() }}

  {%- call macros.card(title=_("Displayed name")) %}
  {{ macros.form_field(form.displayed_name) }}
  <div class="row mt-2">
    <div class="col-12">
      <div class="form-group">
        <label class="form-label">{{ _('Profile Avatar') }}</label>
        <div class="d-flex align-items-center">
          <div class="mr-3">
            {%- if user.avatar_filename %}
            <img src="{{ url_for('.user_avatar_image', user_email=user.email) }}" 
                 class="img-circle" 
                 alt="Avatar" 
                 style="width: 40px; height: 40px;">
            {%- else %}
            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" 
                 style="width: 40px; height: 40px; font-weight: bold;">
              {{ user.get_avatar_initials() }}
            </div>
            {%- endif %}
          </div>
          <a href="{{ url_for('.user_avatar', user_email=user.email if user.email != current_user.email else None) }}" 
             class="btn btn-sm btn-outline-secondary">
            <i class="fa fa-edit"></i> {{ _('Manage Avatar') }}
          </a>
        </div>
        <small class="form-text text-muted">{{ _('Upload or change your profile picture') }}</small>
      </div>
    </div>
  </div>
  {%- endcall %}

  {%- call macros.card(title=_("Antispam")) %}
  {%- call macros.fieldset(field=form.spam_enabled, enabled=user.spam_enabled) %}
  {{ macros.form_field(form.spam_mark_as_read) }}
  {{ macros.form_field(form.spam_threshold, step=1, max=100,
     prepend='<span class="input-group-text"><span id="spam_threshold_value"></span>&nbsp;/&nbsp;100</span>') }}
  {%- endcall %}
  {%- endcall %}

  {%- call macros.card(title=_("Auto-forward")) %}
  {%- call macros.fieldset(
      field=form.forward_enabled,
      enabled=user.forward_enabled,
      fields=[form.forward_keep, form.forward_destination]) %}
  {%- endcall %}
  {%- endcall %}

  {{ macros.form_field(form.submit) }}
</form>
{%- endblock %}
